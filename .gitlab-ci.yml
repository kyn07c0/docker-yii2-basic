variables:
  VERSION: 1.0.${CI_PIPELINE_ID}

stages:
  - build
  - test

build:
  stage: build
  image: docker:27.1.2-cli-alpine3.20
  script:
    - docker build -t jii2-web:${VERSION} .
    - docker push ${CI_REGISTRY_IMAGE}:${VERSION}
#    - docker-compose up -d --build
  only:
    - develop

#test:
#  stage: test
#  image: docker:27.1.2-cli-alpine3.20
#  needs:
#    - build
#  script:
#    - echo "Running tests"
#    - docker exec -it jii2-web ./vendor/bin/codecept run
#  only:
#    - develop
#  when: on_success
