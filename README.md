## Описание 
Репозиторий содержит код, который позволяет упаковать приложение jii2 в контейнер и протестировать его.

## Структура
```
├── docker
│   ├── docker-compose.yml
│   ├── mariadb
│   │   ├── Dockerfile
│   │   └── init_db_jii2.sql
│   └── php-apache
│       ├── apache.conf
│       ├── db.php
│       ├── Dockerfile
│       └── jii2
├── .gitlab-ci.yml
└── README.md
```

## Процесс CI
В корневой директории проекта находится файл .gitlab-ci.yml, который запускает процесс CI в случае появления новых коммитов в ветке develop. 
Процесс CI состоит из следующих этапов:
1) Сборка приложения. 
Последовательно выполняется создание двух образов из Dockerfile. 
Первый образ создаётся на основе mariadb:10.4 и называется jii2-db. 
В каталог /docker-entrypoint-initdb.d этого образа помещается файл init_db_jii2.sql, который содержит команды для создании базы данных jii2 при первом запуске контейнера.
Второй образ создаётся на основе php:7.4-apache и называется jii2-web.
В процессе его создания происходит копирование исходных файлов приложения jii2 и установка всех необходимых для его работы пакетов. 
2) Тестирование. На этом этапе создаются контейнеры jii2-web и jii2-db и выполняется модульные и функциональные тесты (vendor/bin/codecept run). 
После успешного выполнения тестов контейнеры останавливаются и удаляются.

# Переменные Gitlab-CI
|Переменная|Описание|
|----------|--------|
|MARIADB_DATABASE|Название базы данных приложения jii2|
|MARIADB_USER|Пользователь базы данных jii2|
|MARIADB_PASSWORD|Пароль пользователя базы данных jii2|
|MARIADB_ROOT_PASSWORD|Пароль пользователя с правами администратора(root) базы данных MariaDB|
